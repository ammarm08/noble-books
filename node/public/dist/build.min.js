/*! noble-books 27-06-2016 */
window.initBooksPage=function(){$(document).ready(function(){function a(){W.tooltip(),Y.tooltip()}function b(){V.mouseup(function(a){$(this).blur()}),W.on("click",m),X.on("click",n),Y.on("click",l),U.on("click",d),V.on("click",e),Z.on("click",f)}function c(a){T.append($('<div class="loader"><img src="https://s3.amazonaws.com/bookswell-media/img-assets/default.svg"/></div>')),S.fadeIn(),a=a||"",$.ajax({type:"GET",url:"/api/books?sort="+a,success:function(a){S.fadeOut(1500),T.empty(),N=a,O=N,v(J,O),J++}})}function d(a){a.preventDefault(),$(".advanced-filter:visible").length?($(".advanced-filter").hide(),$(".show-advanced").text("Advanced Filters")):($(".advanced-filter").show(),$(".show-advanced").text("Hide Filters"))}function e(a){g(),O=h(),v(J,O),p(),J++}function f(a){a.preventDefault(),g();var b=$(this).data("sort"),d=$('[data-sort="'+b+'"]').text();$("#current-sort").text("Sort By: "+d),c(b)}function g(){T.empty(),J=0}function h(){return N.filter(function(a){return i(a.genre)&&j(a.length)&&k(a.year)})}function i(a){return Q.indexOf(a)!==-1}function j(a){return P.indexOf("short")!==-1&&a<150||(P.indexOf("medium")!==-1&&a>150&&a<400||P.indexOf("long")!==-1&&a>400)}function k(a){return R.indexOf(1900)!==-1&&a<1900||(R.indexOf(1901)!==-1&&a>=1900&&a<2e3||R.indexOf(2e3)!==-1&&a>=2e3)}function l(a){a.preventDefault(),"all"===$(this).data("length")?(q(Y,$(this)),P=L):$(this).hasClass("active")?(r($(this)),P=s(P,"length",$(this))):$(".filter-by-length .active").length>=2?$(".all_lengths").trigger("click"):($(this).addClass("active"),$(".all_lengths").removeClass("active"),P=t(P,$(".filter-by-length .active")),u(P,$(this).data("length"))),o()}function m(a){a.preventDefault(),"all"===$(this).data("age")?(q(W,$(this)),R=M):$(this).hasClass("active")?(r($(this)),R=s(R,"age",$(this))):$(".filter-by-age .active").length>=2?$(".all_ages").trigger("click"):($(this).addClass("active"),$(".all_ages").removeClass("active"),R=t(R,$(".filter-by-age .active")),u(R,$(this).data("age"))),o()}function n(a){a.preventDefault(),"All"===$(this).data("genre")?(q(X,$(this)),Q=K):$(this).hasClass("active")?(r($(this)),Q=s(Q,"genre",$(this))):$(".filter-by-genre .active").length>=6?$(".all_genres").trigger("click"):($(this).addClass("active"),$(".all_genres").removeClass("active"),Q=t(Q,$(".filter-by-genre .active")),u(Q,$(this).data("genre"))),o()}function o(){V.hasClass("active")||V.addClass("active")}function p(){V.hasClass("active")&&V.removeClass("active")}function q(a,b){a.removeClass("active"),b.addClass("active")}function r(a){a.removeClass("active"),a.blur()}function s(a,b,c){return a.filter(function(a){return a!==c.data(b)})}function t(a,b){return 1===b.length?[]:a}function u(a,b){a.push(b)}function v(a,b){w(b.slice(15*a,15+15*a)),x(b)}function w(a){a.forEach(function(a){y(a)})}function x(a){var b=a.length,c=z(b),d=$('<a class="next_results"></a>');d.text("More Results (viewing "+c+" of "+b+")"),d.click({book_data:a},A),T.append(d)}function y(a){var b=$('<li class="list-group-item" style="display: none"></li>'),c=$('<div class="book" data-toggle="modal" data-target="#bookModal"></div>'),d=$('<div class="book_title"></div>'),e=$('<div class="book_author"></div>');d.text(C(a.title)),e.text(a.author),c.append(d).append(e),c.click({book:a},G);var f=$('<div class="book_data"></div>'),g=$('<div class="book_genre">'+a.genre+"</div>"),h=$('<div class="book_length">'+a.length+" pages  ("+B(a.year)+")</div>");f.append(g).append(h);var i=$('<div class="book_recommenders"></div>');H(a,i),I(a,i),b.append(c).append(f).append(i),T.append(b),b.fadeIn(1e3)}function z(a){return a<=15+15*J?a:15+15*J}function A(a){this.remove(),a.preventDefault(),v(J,a.data.book_data),J++}function B(a){return a<0?parseInt(Math.abs(a))+" BC":parseInt(a)<1400?parseInt(a)+" AD":a}function C(a){return a.length>50?a.slice(0,50)+"...":a}function D(a){for(var b=0,c=-1;b<a.length;){if('""'!==a[b]){c=b;break}b++}return c}function E(a){var b=D(a.reviews),c=a.reviews[b],d=a.recommenders[b],e=$("<div></div>");return c?e.text(c+" - "+d):e.text("None found."),e}function F(a){for(var b=0;b<a.recommenders.length;b++){var c=$('<img class="img-circle"/>');c.data("toggle","tooltip"),c.attr("title","Recommended by "+a.recommenders[b]),c.attr("src",a.thumbnails[b]),$(".modal-recommenders").append(c),c.tooltip()}}function G(a){$(".modal-review").empty(),$(".modal-recommenders").empty(),$(".modal-title").text(a.data.book.title),a.data.book.summary.length?$(".modal-about").text(a.data.book.summary):$(".modal-about").text("We don't have one yet in our system, but it'll be here soon! Help us out by suggesting an edit :)"),$(".modal-blurb").text(a.data.book.author),$(".get-book").attr("href",a.data.book.link).attr("target","_blank"),$(".modal-image").attr("src","https://images-na.ssl-images-amazon.com/images/I/41YdCQ5bIAL.jpg"),$(".modal-year").text(B(a.data.book.year)),$(".modal-length").text(a.data.book.length+" pages"),$(".modal-genre").text(a.data.book.genre);var b=E(a.data.book);$(".modal-review").append(b),F(a.data.book)}function H(a,b){for(var c=0;c<a.recommenders.length;c++){var d=$('<img class="img-circle"/>'),e=a.recommenders[c],f='""'===a.reviews[c]?null:a.reviews[c].trim(),g=f?e+": "+f:e;d.data("toggle","tooltip"),d.attr("title",g),d.attr("src",a.thumbnails[c]),b.append(d),d.tooltip()}}function I(a,b){var c=$('<span><a href="#"></a></span>');c.addClass("glyphicon glyphicon-option-vertical"),c.data("toggle","tooltip"),c.attr("title",a.recommenders.join(", ")),c.tooltip(),b.append(c)}var J=0,K=$(".genre_filter").map(function(){return $(this).text().trim()}).toArray(),L=$(".filter-by-length button").map(function(){return $(this).data("length")}).toArray(),M=$(".filter-by-age button").map(function(){return $(this).data("age")}).toArray(),N=[],O=[],P=L,Q=K,R=M,S=$(".loader"),T=$(".books-list"),U=$(".show-advanced"),V=$(".show-results"),W=$(".filter-by-age button"),X=$(".genre_filter"),Y=$(".filter-by-length button"),Z=$(".dropdown-item");a(),b(),c()})},window.initThinkersPage=function(){$(document).ready(function(){function a(){f.append($('<div class="loader"><img src="https://s3.amazonaws.com/bookswell-media/img-assets/default.svg"/></div>')),g.fadeIn(),$.ajax({type:"GET",url:"/api/recommenders",success:function(a){g.fadeOut(1500),f.empty(),e=a,b(e)}})}function b(a){c(a)}function c(a){a.forEach(function(a){d(a)})}function d(a){var b=$('<div class="recommender-collection" style="display: none"></div>'),c=$('<div class="recommender" data-toggle="modal" data-target="#recModal"></div>');c.text(a.name);var d=$('<div class="thumbnail-container" data-toggle="modal" data-target="#recModal"></div>'),e=$('<img class="img-circle"/>');e.attr("src",a.thumbnail),d.append(e),b.append(d).append(c),b.on("click",function(b){b.preventDefault(),$(".modal-title").text(a.name+"'s Picks"),$(".modal-about").text(a.name+" "+a.bio),$(".recommendations-container").empty(),a.recommended_books.forEach(function(a){var b=$('<a class="list-group-item thumbnail recommendation"></a>');b.text(a[0]),b.attr("href",a[1]),b.attr("target","_blank"),b.data("toggle","tooltip"),b.data("placement","middle"),b.attr("title","Source: "+a[2]),b.tooltip(),$(".recommendations-container").append(b)})}),f.append(b),b.fadeIn(1e3)}var e=[],f=$(".books"),g=$(".loader");a()})};