/*! noble-books 13-07-2016 */
window.initBooksPage=function(){$(document).ready(function(){function a(){ba.tooltip(),da.tooltip(),$(".books-list span").tooltip()}function b(){aa.mouseup(function(a){$(this).blur()}),ba.on("click",o),ca.on("click",p),da.on("click",n),_.on("click",f),aa.on("click",g),ea.on("click",h),fa.on("click",K)}function c(){q="/leaders-in-tech"===window.location.pathname?"tech_leaders":"",$.ajax({type:"GET",url:"/api/books?sort="+q,success:function(a){T=a,U=T,B(U),d(),0===$("#email-signup").length&&A(),O++}})}function d(){$(".book-row").each(function(a){var b=$(this);b.data("book-title",U[a].title),b.data("book-author",U[a].author),b.data("book-summary",U[a].summary),b.data("book-link",U[a].link),b.data("book-year",U[a].year),b.data("book-genre",U[a].genre),b.data("book-reviews",U[a].reviews),b.data("book-recommenders",U[a].recommenders),b.data("book-length",U[a].length),b.data("book-thumbnails",U[a].thumbnails),b.find(".img-circle").each(function(b){var c=U[a].reviews[b],d=U[a].recommenders[b],e='""'===c?d:d+": "+c;$(this).attr("title",e),$(this).tooltip()})})}function e(a){Z.append($('<div class="loader"><img src="https://s3.amazonaws.com/bookswell-media/img-assets/default.svg"/></div>')),Y.fadeIn(),a=a||"",$.ajax({type:"GET",url:"/api/books?sort="+a,success:function(a){Y.fadeOut(1500),Z.empty(),T=a,U=T,y(O,U),O++}})}function f(a){a.preventDefault(),$(".advanced-filter:visible").length?($(".advanced-filter").hide(),$(".show-advanced").text("Advanced Filters")):($(".advanced-filter").show(),$(".show-advanced").text("Hide Filters")),$(this).blur()}function g(a){i(),U=j(),y(O,U),s(),O++}function h(a){a.preventDefault(),i();var b=$(this).data("sort"),c=$('[data-sort="'+b+'"]').text();$("#current-sort").text("Sort By: "+c),e(b)}function i(){Z.empty(),O=0}function j(){return T.filter(function(a){return k(a.genre)&&l(a.length)&&m(a.year)})}function k(a){return W.indexOf(a)!==-1}function l(a){return V.indexOf("short")!==-1&&a<150||(V.indexOf("medium")!==-1&&a>150&&a<400||V.indexOf("long")!==-1&&a>400)}function m(a){return X.indexOf(1900)!==-1&&a<1900||(X.indexOf(1901)!==-1&&a>=1900&&a<2e3||X.indexOf(2e3)!==-1&&a>=2e3)}function n(a){a.preventDefault(),"all"===$(this).data("length")?(t(da,$(this)),V=R):$(this).hasClass("active")?(u($(this)),V=v(V,"length",$(this))):$(".filter-by-length .active").length>=2?$(".all_lengths").trigger("click"):($(this).addClass("active"),$(".all_lengths").removeClass("active"),V=w(V,$(".filter-by-length .active")),x(V,$(this).data("length"))),r()}function o(a){a.preventDefault(),"all"===$(this).data("age")?(t(ba,$(this)),X=S):$(this).hasClass("active")?(u($(this)),X=v(X,"age",$(this))):$(".filter-by-age .active").length>=2?$(".all_ages").trigger("click"):($(this).addClass("active"),$(".all_ages").removeClass("active"),X=w(X,$(".filter-by-age .active")),x(X,$(this).data("age"))),r()}function p(a){a.preventDefault(),"All"===$(this).data("genre")?(t(ca,$(this)),W=Q):$(this).hasClass("active")?(u($(this)),W=v(W,"genre",$(this))):$(".filter-by-genre .active").length>=6?$(".all_genres").trigger("click"):($(this).addClass("active"),$(".all_genres").removeClass("active"),W=w(W,$(".filter-by-genre .active")),x(W,$(this).data("genre"))),r()}function r(){aa.hasClass("active")||aa.addClass("active")}function s(){aa.hasClass("active")&&aa.removeClass("active")}function t(a,b){a.removeClass("active"),b.addClass("active")}function u(a){a.removeClass("active"),a.blur()}function v(a,b,c){return a.filter(function(a){return a!==c.data(b)})}function w(a,b){return 1===b.length?[]:a}function x(a,b){a.push(b)}function y(a,b){z(b.slice(a*P,P+a*P)),B(b)}function z(a){a.forEach(function(a,b){C(a,b)}),0===$("#email-signup").length&&A()}function A(){var a=$('<a id="email-signup" class="list-group-item"> Get early access to new books and exclusive author interviews. </a>');a.attr("href","http://eepurl.com/b5XRYX"),a.attr("target","_blank"),$(".books-list li:eq(4)").after(a)}function B(a){var b=a.length,c=D(b),d=$('<a class="next_results"></a>');d.text("More Results (viewing "+c+" of "+b+")"),d.click({book_data:a},E),Z.append(d)}function C(a,b){var c=$('<li class="list-group-item book-row" style="display: none"></li>'),d=$('<div class="book" data-toggle="modal" data-target="#bookModal"></div>'),e=$('<div class="book_title"></div>'),f=$('<div class="book_author"></div>');d.data("book-title",a.title),d.data("book-author",a.author),d.data("book-summary",a.summary),d.data("book-link",a.link),d.data("book-year",a.year),d.data("book-genre",a.genre),d.data("book-reviews",a.reviews),d.data("book-recommenders",a.recommenders),d.data("book-length",a.length),d.data("book-thumbnails",a.thumbnails),d.on("click",K),e.text(G(a.title)),f.text(a.author),d.append(e).append(f);var g=$('<div class="book_data"></div>'),h=$('<div class="book_genre">'+a.genre+"</div>"),i=$('<div class="book_length">'+a.length+" pages  ("+F(a.year)+")</div>");g.append(h).append(i);var j=$('<div class="book_recommenders"></div>');M(a,j),N(a,j),c.append(d).append(g).append(j),Z.append(c),c.fadeIn(1e3)}function D(a){return a<=P+O*P?a:P+O*P}function E(a){this.remove(),a.preventDefault(),y(O,a.data.book_data),O++}function F(a){return a<0?parseInt(Math.abs(a))+" BC":parseInt(a)<1400?parseInt(a)+" AD":a}function G(a){return a.length>50?a.slice(0,50)+"...":a}function H(a){for(var b=0,c=-1;b<a.length;){if('""'!==a[b]){c=b;break}b++}return c}function I(a,b){var c=H(a),d=a[c],e=b[c],f=$("<div></div>");return d?f.text(d+" - "+e):f.text("None found."),f}function J(a,b){for(var c=0;c<a.length;c++){var d=$('<img class="img-circle"/>');d.data("toggle","tooltip"),d.attr("title","Recommended by "+a[c]),d.attr("src",b[c]),$(".modal-recommenders").append(d),d.tooltip()}}function K(a){$(".modal-review").empty(),$(".modal-recommenders").empty(),$(".modal-title").text($(this).data("book-title")),$(this).data("book-summary").length?$(".modal-about").text($(this).data("book-summary")):$(".modal-about").text("We don't have one yet in our system, but it'll be here soon! Help us out by suggesting an edit :)"),$(".modal-blurb").text($(this).data("book-author")),$(".get-book").attr("href",$(this).data("book-link")).attr("target","_blank"),$(".modal-image").attr("src","https://images-na.ssl-images-amazon.com/images/I/41YdCQ5bIAL.jpg"),$(".modal-year").text(F($(this).data("book-year"))),$(".modal-length").text($(this).data("book-length")+" pages"),$(".modal-genre").text($(this).data("book-genre"));var b=I($(this).data("book-reviews"),$(this).data("book-recommenders"));$(".modal-review").append(b),J($(this).data("book-recommenders"),$(this).data("book-thumbnails")),$(this).data("book-link").indexOf("amazon.com")>-1&&L($(this).data("book-link"))}function L(a){$("#gr_add_to_books").empty();var b=$('<div class="gr_custom_each_container_"></div>'),c=$('<a target="_blank" style="border:none"></a>'),d=$("<script></script>"),e=a.split("/").pop(),f="?atmb_widget%5Bbutton%5D=atmb_widget_1.png&amp;atmb_widget%5Bhide_friends%5D=on",g="https://www.goodreads.com/book/add_to_books_widget_frame/"+e+f,h="https://www.goodreads.com/book/isbn/"+e;c.attr("href",h),d.attr("src",g),b.append(c),$("#gr_add_to_books").append(b).append(d)}function M(a,b){for(var c=0;c<a.recommenders.length;c++){var d=$('<img class="img-circle"/>'),e=a.recommenders[c],f='""'===a.reviews[c]?null:a.reviews[c].trim(),g=f?e+": "+f:e;d.data("toggle","tooltip"),d.attr("title",g),d.attr("src",a.thumbnails[c]),b.append(d),d.tooltip()}}function N(a,b){var c=$('<span><a href="#"></a></span>');c.addClass("glyphicon glyphicon-option-vertical"),c.data("toggle","tooltip"),c.attr("title",a.recommenders.join(", ")),c.tooltip(),b.append(c)}var O=0,P=10,Q=$(".genre_filter").map(function(){return $(this).text().trim()}).toArray(),R=$(".filter-by-length button").map(function(){return $(this).data("length")}).toArray(),S=$(".filter-by-age button").map(function(){return $(this).data("age")}).toArray(),T=[],U=[],V=R,W=Q,X=S,Y=$(".loader"),Z=$(".books-list"),_=$(".show-advanced"),aa=$(".show-results"),ba=$(".filter-by-age button"),ca=$(".genre_filter"),da=$(".filter-by-length button"),ea=$(".dropdown-item"),fa=$(".book-row");a(),b(),c()})},window.initThinkersPage=function(){$(document).ready(function(){function a(){$.ajax({type:"GET",url:"/api/recommenders",success:function(a){d=a,b()}})}function b(){$(".thumbnail-container").each(function(a){var b=$(this);b.data("recommended-books",d[a].recommended_books)})}function c(a){$(".modal-title").text($(this).data("name")+"'s Picks"),$(".modal-about").text($(this).data("name")+" "+$(this).data("bio")),$(".recommendations-container").empty();for(var b=$(this).data("recommended-books"),c=0;c<b.length;c++){var d=$("<div></div>"),e=$('<a class="list-group-item thumbnail recommendation"></a>'),f=$('<a class="glyphicon glyphicon-question-sign"></a>');e.text(b[c][0]),e.attr("href",b[c][1]),e.attr("target","_blank"),f.attr("title","Source"),f.attr("href",b[c][2]),f.attr("target","_blank"),f.data("toggle","tooltip"),f.tooltip(),d.append(e).append(f),$(".recommendations-container").append(d)}}var d=[];$(".recs");$(".thumbnail-container").on("click",c),a()})};